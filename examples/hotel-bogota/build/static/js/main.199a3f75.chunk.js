(this["webpackJsonphotel-bogota"]=this["webpackJsonphotel-bogota"]||[]).push([[0],{119:function(e,t,n){},121:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){},129:function(e,t,n){},144:function(e,t){},154:function(e,t,n){},155:function(e,t,n){"use strict";n.r(t);var a=n(8),r=n(0),i=n.n(r),o=n(18),s=n.n(o),c=(n(119),n(4)),l=n.n(c),u=n(34),d=n(28),m=n(192),h=n(196),f=n(157);n(121);var g=function(e){var t=e.title;return Object(a.jsx)(m.a,{className:"logoCard",children:Object(a.jsxs)(h.a,{className:"cardContent",children:[Object(a.jsx)(f.a,{gutterBottom:!0,variant:"h1",component:"h1",children:t}),Object(a.jsxs)("div",{className:"logo-wrapper",children:[Object(a.jsx)("div",{className:"logo-emblem"}),Object(a.jsx)("div",{className:"logo-emblem"}),Object(a.jsx)("div",{className:"logo-emblem"})]})]})})},p=n(202),b=n(204),k=n(203),v=n(48),j=n(75),y=n(197),O=n(208),x=n(211),w=n(201),I=n(199),N=n(198);n(125);var S=function(e){var t=e.tokenInstance,n=e.applyDiscount,r=e.discount,i=r.tokenInstance&&r.tokenInstance.ticketId===t.ticketId;return Object(a.jsxs)("div",{onClick:function(e){return n(i?null:t)},className:i?"tokenCard selected":"tokenCard",children:[Object(a.jsxs)("div",{className:"ticketDetails",children:[Object(a.jsx)(f.a,{className:"ticketClass",gutterBottom:!0,variant:"h5",component:"h2",children:t.ticketClass.toString()}),Object(a.jsx)(f.a,{className:"ticketId",variant:"body2",color:"textSecondary",component:"p",children:t.ticketId.toString()}),Object(a.jsxs)(f.a,{className:"devconId",variant:"body2",color:"textSecondary",component:"p",children:["Devcon ID: ",t.devconId.toString()]})]}),Object(a.jsx)("img",{className:"ticketImg",src:"ticket_example_image.svg"})]})};n(126);function P(e){var t=e.roomType,n=e.applyDiscount,o=e.discount,s=e.price,c=e.tokens,l=e.book,u=i.a.useState(!1),m=Object(d.a)(u,2),h=m[0],f=m[1],g=Object(r.useReducer)((function(e,t){return Object(j.a)(Object(j.a)({},e),t)}),{reference:"Beeple",cardNo:"00000000000",cardSort:"00-00-00",cardCsv:"000"}),p=Object(d.a)(g,2),b=p[0],k=p[1],P=function(e){var t=e.target.name,n=e.target.value;k(Object(v.a)({},t,n))},C=function(e){e.preventDefault(),l({formInput:b,roomType:t})},T=function(){f(!1)},D=s-(o.value?o.value:0)/100*s,E=["0"];return Object(a.jsxs)("div",{children:[Object(a.jsx)(y.a,{size:"small",color:"primary",onClick:function(){f(!0)},children:"Book"}),Object(a.jsx)(x.a,{open:h,onClose:T,"aria-labelledby":"form-dialog-title",children:Object(a.jsxs)("div",{className:"modalContainer",children:[Object(a.jsx)(N.a,{className:"title",disableTypography:!0,children:t}),Object(a.jsxs)(N.a,{className:"subTitle",disableTypography:!0,children:[D," COP per night. ",o.value?"(".concat(o.value,"% discount)"):""]}),Object(a.jsx)(I.a,{children:Object(a.jsxs)("form",{onSubmit:C,children:[Object(a.jsxs)("div",{style:{border:"1px solid darkcyan",padding:"7px 12px",fontSize:"14px",display:"flex",justifyContent:"space-between"},children:[Object(a.jsx)("div",{style:{textAlign:"left"},children:"check in 01/08/2021"}),Object(a.jsx)("div",{style:{textAlign:"left"},children:"check out 15/08/2021"})]}),Object(a.jsx)("div",{style:{borderLeft:"1px solid darkcyan",borderRight:"1px solid darkcyan",borderBottom:"1px solid darkcyan",padding:"7px 12px",fontSize:"14px",textAlign:"left"},children:Object(a.jsxs)("div",{children:["Total ",14*D," COP"]})}),Object(a.jsx)("div",{children:c.length>0&&Object(a.jsx)("p",{className:"smallCopy",children:"Select a ticket to apply discount:"})}),Object(a.jsx)("div",{className:"ticketWrapper",children:c&&c.filter((function(e){return E.toString().indexOf(e.ticketClass)>-1})).map((function(e,t){return Object(a.jsx)("div",{children:Object(a.jsx)(S,{applyDiscount:n,tokenInstance:e,discount:o})},t)}))}),Object(a.jsx)(O.a,{id:"booking-name",label:"Reference name",placeholder:"Beeple",value:"Beeple",helperText:"(a check-in reference name for your booking)",fullWidth:!0,name:"reference",margin:"normal",onChange:P,InputLabelProps:{shrink:!0}}),Object(a.jsx)(O.a,{id:"card-no",label:"Card Number",fullWidth:!0,placeholder:"00000000000",value:"00000000000",name:"cardNo",margin:"normal",onChange:P,InputLabelProps:{shrink:!0}}),Object(a.jsx)(O.a,{id:"card-sort",label:"Card Sort Number",fullWidth:!0,placeholder:"00-00-00",value:"00-00-00",name:"cardSort",margin:"normal",onChange:P,InputLabelProps:{shrink:!0}}),Object(a.jsx)(O.a,{id:"card-csv",label:"CSV",fullWidth:!0,value:"000",placeholder:"000",name:"cardCsv",margin:"normal",onChange:P,InputLabelProps:{shrink:!0}}),Object(a.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",marginTop:"12px"},children:[Object(a.jsx)("div",{style:{color:"grey",fontSize:"12px",marginRight:"5px"},children:"cards accepted"}),Object(a.jsx)("img",{style:{width:"100px",height:"24px"},src:"./cards-accepted-demo.png"})]})]})}),Object(a.jsx)("div",{className:"booking",children:Object(a.jsxs)(w.a,{children:[Object(a.jsx)(y.a,{onClick:T,color:"primary",children:"Cancel"}),Object(a.jsx)(y.a,{onClick:C,color:"primary",disabled:!1,children:"Pay Now"})]})})]})})]})}n(127);var C=Object(p.a)({root:{maxWidth:345,margin:"20px"},media:{height:140}});function T(e){var t=e.room,n=e.applyDiscount,r=e.discount,i=e.tokens,o=e.book,s=C(),c=t.type,l=t.price,u=t.image,d=t.frequency;return Object(a.jsxs)(m.a,{className:"roomCard",children:[Object(a.jsxs)("div",{children:[Object(a.jsx)(k.a,{className:s.media,image:u,title:"token"}),Object(a.jsxs)(h.a,{children:[Object(a.jsx)(f.a,{gutterBottom:!0,variant:"h5",component:"h2",children:c}),Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["From ",l," COP / ",d]})]})]}),Object(a.jsx)(b.a,{children:Object(a.jsx)(P,{book:o,applyDiscount:n,tokens:i,roomType:c,discount:r,price:l})})]})}var D=n(205);n(128);function E(e){var t=e.tokensNumber;return Object(a.jsxs)(m.a,{className:"tokenNotificationCard",children:[Object(a.jsxs)(h.a,{children:[Object(a.jsxs)(f.a,{gutterBottom:!0,variant:"h1",component:"h1",children:[t," Devcon Tickets"]}),Object(a.jsx)(f.a,{gutterBottom:!0,variant:"body1",component:"p",children:"booking discounts available"})]}),Object(a.jsx)("div",{className:"cardBottomLip"})]})}var U=function(e){var t=e.getTokens,n=e.negotiator,i=e.tokensNumber,o=Object(r.useState)(void 0),s=Object(d.a)(o,2),c=s[0],l=s[1],u=function(e){n.setUserPermission(e),l(n.getUserPermission())};return Object(r.useEffect)((function(){l(n.getUserPermission()),!0===c&&t()}),[c]),Object(a.jsx)(D.a,{in:!0,style:{transitionDelay:"500ms"},children:Object(a.jsxs)("div",{children:[c&&Object(a.jsx)(E,{tokensNumber:i}),void 0===c&&Object(a.jsxs)(m.a,{className:"tokenNotificationCard",children:[Object(a.jsxs)(h.a,{children:[Object(a.jsx)(f.a,{gutterBottom:!0,variant:"body1",component:"p",children:"Do you give permission for Devcon to connect with this website?"}),Object(a.jsx)("button",{onClick:function(e){return u(!0)},children:"YES"})," ",Object(a.jsx)("button",{onClick:function(e){return u(!1)},children:"NO"})]}),Object(a.jsx)("div",{className:"cardBottomLip"})]})]})})},B=(n(129),function(){return Object(a.jsx)("div",{className:"ethScale",children:Object(a.jsx)("div",{id:"space",children:Object(a.jsxs)("div",{className:"elogo",children:[Object(a.jsx)("div",{className:"trif u1"}),Object(a.jsx)("div",{className:"trif u2"}),Object(a.jsx)("div",{className:"trif u3"}),Object(a.jsx)("div",{className:"trif u4"}),Object(a.jsx)("div",{className:"ct"}),Object(a.jsx)("div",{className:"trif l1"}),Object(a.jsx)("div",{className:"trif l4"})]})})})}),A=n(206),L=n(101),M=n(24),K=n(209);function R(e){var t=e.label,n=e.handleInput,r=e.date;return Object(a.jsx)(M.a,{utils:L.a,children:Object(a.jsx)(A.a,{container:!0,justify:"space-around",children:Object(a.jsx)(K.a,{disableToolbar:!0,variant:"inline",format:"dd/MM/yyyy",margin:"normal",className:"date-picker-inline",label:t,disabled:!0,value:r,onChange:function(e){return n(e,t)},KeyboardButtonProps:{"aria-label":"change date"}})})})}var q=function(){var e=new Date,t=new Date;t.setDate(t.getDate()+1);var n=Object(r.useState)({from:e,to:t}),i=Object(d.a)(n,2),o=(i[0],i[1]),s=function(e,t){o(Object(v.a)({},t,e))};return Object(a.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(a.jsxs)("div",{style:{display:"flex",justifyContent:"center",width:"80%"},children:[Object(a.jsx)("div",{style:{margin:"10px"},children:Object(a.jsx)(R,{name:"from",label:"check in",handleInput:s,date:"08/01/2021"})}),Object(a.jsx)("div",{style:{margin:"10px"},children:Object(a.jsx)(R,{name:"to",label:"check out",handleInput:s,date:"08/15/2021"})})]})})},W=n(96),V=(n(154),[{type:"Deluxe Room",price:2e5,frequency:"per night",image:"./hotel_3.jpg"},{type:"King Suite",price:32e4,frequency:"per night",image:"./hotel_2.png"},{type:"Superior Deluxe Suite",price:250030,frequency:"per night",image:"./hotel_1.jpg"}]);var _=function(){var e=new W.a({},"devcon-ticket",{userPermissionRequired:!0}),t=Object(r.useState)([]),n=Object(d.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(!1),c=Object(d.a)(s,2),m=c[0],h=c[1],p=Object(r.useState)([]),b=Object(d.a)(p,2),k=b[0],v=b[1],j=Object(r.useState)({value:void 0,tokenInstance:null}),y=Object(d.a)(j,2),O=y[0],x=y[1],w=Object(r.useState)({status:!1,useTicket:void 0,ethKey:void 0}),I=Object(d.a)(w,2),N=I[0],S=I[1],P=function(){var t=Object(u.a)(l.a.mark((function t(n){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&null!==n){t.next=5;break}x({value:void 0,tokenInstance:void 0}),S({status:!1,proof:void 0,useEthKey:void 0}),t.next=11;break;case 5:return"https://raw.githubusercontent.com/TokenScript/token-negotiator/main/examples/hotel-bogota/mockbackend-responses/un.json",t.next=8,e.authenticate({unEndPoint:"https://raw.githubusercontent.com/TokenScript/token-negotiator/main/examples/hotel-bogota/mockbackend-responses/un.json",unsignedToken:n});case 8:a=t.sent,console.log("authenticationData",a),!0===a.status&&a.useEthKey&&a.proof&&(S(a),x({value:10,tokenInstance:n}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),C=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"https://raw.githubusercontent.com/TokenScript/token-negotiator/main/examples/hotel-bogota/mockbackend-responses/pay.json",n={discount:N,bookingData:{formData:t}},console.log("useDiscountProof",n),fetch("https://raw.githubusercontent.com/TokenScript/token-negotiator/main/examples/hotel-bogota/mockbackend-responses/pay.json"+new URLSearchParams(n)).then((function(e){alert("Transaction Complete, we look forward to your stay with us!")}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){v(V)}),[]),Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"header",children:[Object(a.jsx)(g,{title:"Hotel Bogota"}),Object(a.jsx)(U,{getTokens:function(t){e.negotiate().then((function(e){e.success&&(o(e.tokens),h(!0))}))},negotiator:e,tokensNumber:i.length})]}),Object(a.jsx)(q,{}),Object(a.jsx)("div",{className:"roomCardsContainer",children:k.map((function(e,t){return Object(a.jsx)(T,{room:e,applyDiscount:P,discount:O,tokens:i,book:C},t)}))}),m&&Object(a.jsxs)("div",{children:[Object(a.jsx)(B,{}),Object(a.jsx)(f.a,{style:{padding:"20px"},className:"applyDiscountCopyContainer",gutterBottom:!0,variant:"body2",component:"p",children:"Free shuttle service available to you as a Devcon Ticket holder! Enjoy the event."})]})]})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,214)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};s.a.render(Object(a.jsx)(_,{}),document.getElementById("root")),F()},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(5),r=n(6),i=n(17),o=n(19),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(a.a)(this,e),"string"==typeof t)throw new TypeError("Unimplemented: Not accepting string yet.");if(t instanceof ArrayBuffer){var n=fromBER(t);this.fromSchema(n.result)}else this.algorithmId=Object(o.getParametersValue)(t,"algorithmId"),"algorithmParams"in t&&(this.algorithmParams=Object(o.getParametersValue)(t,"algorithmParams",e.defaultValues("algorithmParams")))}return Object(r.a)(e,[{key:"fromSchema",value:function(t){Object(o.clearProps)(t,["algorithm","params"]);var n=Object(i.compareSchema)(t,t,e.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===n.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=n.result.algorithm.valueBlock.toString(),"params"in n.result&&(this.algorithmParams=n.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new i.ObjectIdentifier({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof asn1js.Any===!1&&e.push(this.algorithmParams),new i.Sequence({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof asn1js.Any===!1&&(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(t){return t instanceof e!==!1&&(this.algorithmId===t.algorithmId&&("algorithmParams"in this?"algorithmParams"in t&&JSON.stringify(this.algorithmParams)===JSON.stringify(t.algorithmParams):!("algorithmParams"in t)))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithmParams":return new i.Any;default:throw new Error("Invalid member name for AlgorithmIdentifier class: ".concat(e))}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof asn1js.Any;default:throw new Error("Invalid member name for AlgorithmIdentifier class: ".concat(e))}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(o.getParametersValue)(e,"names",{});return new i.Sequence({name:t.blockName||"",optional:t.optional||!1,value:[new i.ObjectIdentifier({name:t.algorithmIdentifier||"algorithm"}),new i.Any({name:t.algorithmParams||"parameters",optional:!0})]})}}]),e}()},76:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(5),r=n(6),i=n(17),o=n(19),s=n(74),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(a.a)(this,e),"string"==typeof t)throw new TypeError("Not accepting string. For base64, convert to ArrayBuffer.");if(t instanceof ArrayBuffer){var n=Object(i.fromBER)(t);this.fromSchema(n.result)}else this.signatureAlgorithm=Object(o.getParametersValue)(t,"signatureAlgorithm"),this.publicKey=Object(o.getParametersValue)(t,"publicKey")}return Object(r.a)(e,[{key:"fromSchema",value:function(t){if(Object(o.clearProps)(t,["signatureAlgorithm","publicKey"]),!1===Object(i.compareSchema)(t,t,e.schema({names:{signatureAlgorithm:"signatureAlgorithm",publicKey:"publicKey"}})).verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier")}}],[{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(o.getParametersValue)(e,"names",{});return new i.Sequence({name:t.blockName||"",optional:!0,value:[s.a.schema(t.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new i.BitString({name:"publicKey"})]})}}]),e}()},96:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var a=n(4),r=n.n(a),i=n(34),o=n(5),s=n(6),c=n(97),l=n(51),u=function(e){var t={};return"devcon-ticket"===e?t={attestationOrigin:"https://stage.attestation.id",tokenOrigin:"https://devcontickets.herokuapp.com/outlet/",tokenUrlName:"ticket",tokenSecretName:"secret",unsignedTokenDataName:"ticket",tokenIdName:"id",tokenParser:c.a,localStorageItemName:"dcTokens",localStorageEthKeyItemName:"dcEthKeys"}:console.log("Negotiator: missing token script for this token"),t},d=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{userPermissionRequired:!1};Object(o.a)(this,t),a||console.log("Negotiator: tokenId is a required parameter");var i=u(a);if(this.userPermissionRequired=r.userPermissionRequired,this.userPermissionStatus=!r.userPermissionRequired||void 0,this.queuedCommand=!1,this.filter=n,this.tokensOrigin=i.tokenOrigin,this.debug=0,this.hideTokensIframe=1,this.tokenOrigin=i.tokenOrigin,this.attestationOrigin=i.attestationOrigin,this.tokenUrlName=i.tokenUrlName,this.tokenSecretName=i.tokenSecretName,this.tokenIdName=i.tokenIdName,this.unsignedTokenDataName=i.unsignedTokenDataName,this.tokenParser=i.tokenParser,this.localStorageItemName=i.localStorageItemName,this.localStorageEthKeyItemName=i.localStorageEthKeyItemName,this.addTokenIframe=null,this.maxUNlength=6,this.UNttl=3600,this.UNsecret="0x1234567890abcdef",r.hasOwnProperty("debug")&&(this.debug=r.debug),r.hasOwnProperty("attestationOrigin")&&(this.attestationOrigin=r.attestationOrigin),r.hasOwnProperty("tokenOrigin")&&(this.tokenOrigin=r.tokenOrigin),this.isTokenOriginWebsite=!1,this.attestationOrigin){var s=new URL(window.location.href),c=new URL(this.tokensOrigin);s.origin===c&&(this.isTokenOriginWebsite=!0,this.readMagicUrl()),this.attachPostMessageListener((function(t){if(t.origin===c.origin&&t.data.iframeCommand&&"closeMe"==t.data.iframeCommand&&e.addTokenIframe){e.addTokenIframe.remove();var n=new Event("newTokenAdded");document.body.dispatchEvent(n)}}))}if(window!==window.parent){this.debug&&console.log("negotiator: its iframe, lets return tokens to the parent"),this.attachPostMessageListener(this.listenForParentMessages.bind(this));var l=new URL(document.referrer);window.parent.postMessage({iframeCommand:"iframeReady",iframeData:""},l.origin)}}return Object(s.a)(t,[{key:"connectMetamaskAndGetAddress",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum){e.next=2;break}throw new Error("Please install metamask before.");case 2:return e.next=4,window.ethereum.request({method:"eth_requestAccounts"});case 4:if((t=e.sent)&&t.length){e.next=7;break}throw new Error("Active Wallet required");case 7:return e.abrupt("return",t[0]);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signMessageWithBrowserWallet",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectMetamaskAndGetAddress();case 2:return n=new l.a.providers.Web3Provider(window.ethereum),a=n.getSigner(),e.next=6,a.signMessage(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addTokenThroughIframe",value:function(e){console.log("createTokenIframe fired for : "+e);var t=document.createElement("iframe");this.addTokenIframe=t,t.src=e,t.style.width="1px",t.style.height="1px",t.style.opacity=0,document.body.appendChild(t)}},{key:"setUserPermission",value:function(e){this.userPermissionStatus=e}},{key:"getUserPermission",value:function(){return this.userPermissionStatus}},{key:"listenForParentMessages",value:function(e){var t=new URL(document.referrer);if(e.origin===t.origin&&"undefined"!==typeof e.data.parentCommand&&"undefined"!==typeof e.data.parentData){var n=e.data.parentCommand,a=e.data.parentData;switch(console.log("iframe: command, data = ",n,a),n){case"signToken":if("undefined"===typeof window.Authenticator)return void console.log("Authenticator not defined.");var r=this.getRawToken(a),i=r.token,o=r.secret;this.authenticator=new Authenticator(this);var s={ticketBlob:i,ticketSecret:o,attestationOrigin:this.attestationOrigin};r&&r.id&&(s.email=r.id),r&&r.magic_link&&(s.magicLink=r.magic_link),this.authenticator.getAuthenticationBlob(s,(function(e){console.log("sign result:",e),window.parent.postMessage({iframeCommand:"useTokenData",iframeData:{useToken:e,message:"",success:!!e}},t.origin)}));break;case"tokensList":this.returnTokensToParent()}}}},{key:"commandDisplayIframe",value:function(){var e=new URL(document.referrer);window.parent.postMessage({iframeCommand:"iframeWrap",iframeData:"show"},e.origin)}},{key:"commandHideIframe",value:function(){var e=new URL(document.referrer);window.parent.postMessage({iframeCommand:"iframeWrap",iframeData:"hide"},e.origin)}},{key:"returnTokensToParent",value:function(){var e=this.readTokens();if(e.success&&!e.noTokens){var t=this.decodeTokens(e.tokens),n=this.filterTokens(t);e.tokens=n}var a=new URL(document.referrer);window.parent.postMessage({iframeCommand:"tokensData",iframeData:e},a.origin)}},{key:"readMagicUrl",value:function(){var e=new URLSearchParams(window.location.search),t=e.get(this.tokenUrlName),n=e.get(this.tokenSecretName),a=e.get(this.tokenIdName);if(t&&n){var r=this.readTokens(),i=[],o=!0;if(r.noTokens||(i=r.tokens).map((function(e){e.token===t&&(o=!1)})),o&&i.push({token:t,secret:n,id:a,magic_link:window.location.href}),localStorage.setItem(this.localStorageItemName,JSON.stringify(i)),window!==window.parent){this.debug&&console.log("negotiator: its iframe, lets close it");var s=new URL(document.referrer);window.parent.postMessage({iframeCommand:"closeMe"},s.origin)}}}},{key:"filterTokens",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};0==Object.keys(n).length&&(n=this.filter);var a=[];if(e.length&&"object"===typeof n&&Object.keys(n).length){var r=Object.keys(n);return e.forEach((function(e){var i=1;t.debug&&console.log("test token:",e),r.forEach((function(t){e[t].toString()!=n[t].toString()&&(i=0)})),i&&(a.push(e),t.debug&&console.log("token fits:",e))})),a}return e}},{key:"compareObjects",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n].toString()!==t[n].toString())return!1;for(var n in t)if(t.hasOwnProperty(n)&&e[n].toString()!==t[n].toString())return!1;return!0}},{key:"readTokens",value:function(){var e=localStorage.getItem(this.localStorageItemName),t=[],n={tokens:[],noTokens:!0,success:!0};try{e&&e.length&&(0!==(t=JSON.parse(e)).length&&t.forEach((function(e){e.token&&e.secret&&n.tokens.push(e)})),n.tokens.length&&(n.noTokens=!1))}catch(a){console.log("Cant parse tokens in LocalStorage"),"function"===typeof callBack&&(n.success=!1)}return n}},{key:"getRawToken",value:function(e){var t=this,n=this.readTokens();if(n.success&&!n.noTokens){var a=n.tokens,r=!1;return a.length&&a.forEach((function(n){if(n.token){var a=new t.tokenParser(t.base64ToUint8array(n.token).buffer);if(a&&a[t.unsignedTokenDataName]){var i=a[t.unsignedTokenDataName];t.compareObjects(i,e)&&(r=n)}}else console.log("empty token data received")})),r}}},{key:"listenForIframeMessages",value:function(e){var t=new URL(this.tokensOrigin);if(e.origin===t.origin&&"undefined"!==typeof e.data.iframeCommand&&"undefined"!==typeof e.data.iframeData){var n=e.data.iframeCommand,a=e.data.iframeData;switch(console.log("parent: command, data = ",n,a),n){case"iframeWrap":"show"==a?this.tokenIframeWrap.style.display="block":"hide"==a&&(this.tokenIframeWrap.style.display="none");break;case"tokensData":this.detachPostMessageListener(this.listenForIframeMessages),this.tokenIframeWrap.remove(),a.success&&!a.noTokens&&(a.tokens=this.filterTokens(a.tokens)),this.negotiateCallback(a);break;case"useTokenData":this.tokenIframeWrap.remove(),this.signCallback&&this.signCallback(a),this.signCallback=!1;break;case"iframeReady":e&&e.source&&(e.source.postMessage(this.queuedCommand,e.origin),this.queuedCommand="")}}}},{key:"authenticate",value:function(e){var t=this,n=e.unsignedToken,a=e.unEndPoint;return new Promise(function(){var e=Object(i.a)(r.a.mark((function e(i,o){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._authenticate(n,a,(function(e,n){if(!e||!t.useEthKey)return o(n);i({proof:e,useEthKey:t.useEthKey,status:!0})}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}},{key:"_authenticate",value:function(){var e=Object(i.a)(r.a.mark((function e(t,n,a){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("authenticate request. need to implement UN request/sign"),e.prev=1,e.next=4,this.getChallengeSigned();case 4:i=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),a(null,e.t0),e.abrupt("return");case 11:console.log("useEthKey",i),this.useEthKey=i,this.signCallback=a,this.queuedCommand={parentCommand:"signToken",parentData:t},this.createIframe();case 16:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getInt64Bytes",value:function(e){var t=[],n=8;do{t[--n]=255&e,e>>=8}while(n);return t}},{key:"getUnpredictableNumber",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now()+1e3*this.UNttl,a=Math.floor(Math.random()*Math.pow(10,this.maxUNlength)),e.abrupt("return",{UN:a.toString()+this.createHmac(a,n),Expiry:n});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createHmac",value:function(e,t){var n=this.getInt64Bytes(e).concat(this.getInt64Bytes(t));return l.a.utils.computeHmac("sha256",this.UNsecret,n)}},{key:"ethKeyIsValid",value:function(e){var t=parseInt(e.UN.substr(0,e.UN.length-66));return this.createHmac(t,e.expiry)===e.UN.substr(e.UN.length-66)&&!(e.expiry<Date.now())}},{key:"getChallengeSigned",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem(this.localStorageEthKeyItemName),a=n&&n.length?JSON.parse(n):{},e.next=4,this.connectMetamaskAndGetAddress();case 4:if(i=(i=e.sent).toLowerCase(),a&&a[i]&&!this.ethKeyIsValid(a[i])&&(console.log("remove invalid useEthKey"),delete a[i]),!a||!a[i]){e.next=11;break}o=a[i],e.next=15;break;case 11:return e.next=13,this.signNewChallenge(t);case 13:(o=e.sent)&&(a[o.address.toLowerCase()]=o,localStorage.setItem(this.localStorageEthKeyItemName,JSON.stringify(a)));case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signNewChallenge",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,o,s,c,u,d,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUnpredictableNumber(t);case 2:return n=e.sent,a=n.UN,i=n.Expiry,o=window.location.hostname,s="This is proof that I am visiting ".concat(o,", which has presented the following challenge ").concat(a.toString()," to sign."),e.next=9,this.signMessageWithBrowserWallet(s);case 9:return c=e.sent,u=l.a.utils.hashMessage(s),d=l.a.utils.arrayify(u),m=l.a.utils.recoverAddress(d,c),e.abrupt("return",{address:m,expiry:i,challenge:s,signature:c,UN:a});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"negotiate",value:function(){var e=this;return new Promise((function(t,n){e._negotiate((function(e){if(!e)return n(!1);t(e)}))}))}},{key:"getTokenInstances",value:function(){var e=this;return new Promise((function(t,n){e._negotiate((function(e){if(!e)return n(!1);t(e)}))}))}},{key:"_negotiate",value:function(e){if(!1===this.userPermissionStatus)return!1;if(this.negotiateCallback=e,this.attestationOrigin)if(console.log("attestationOrigin",this.attestationOrigin),window.location.href===this.tokensOrigin){var t=this.readTokens();if(t.success&&!t.noTokens){var n=this.decodeTokens(t.tokens),a=this.filterTokens(n);t.tokens=a,this.negotiateCallback(t)}}else this.queuedCommand={parentCommand:"tokensList",parentData:""},this.createIframe();else console.log("no attestationOrigin...")}},{key:"createIframe",value:function(){console.log("createIframe fired"),this.attachPostMessageListener(this.listenForIframeMessages.bind(this));var e=document.createElement("iframe");this.iframe=e,e.src=this.tokensOrigin,e.style.width="800px",e.style.height="700px",e.style.maxWidth="100%",e.style.background="#fff";var t=document.createElement("div");this.tokenIframeWrap=t,t.setAttribute("style","width:100%; min-height: 100vh; position: fixed; align-items: center; justify-content: center; display: none; top: 0; left: 0; background: #fffa"),t.appendChild(e),document.body.appendChild(t)}},{key:"base64ToUint8array",value:function(t){return t=t.split("-").join("+").split("_").join("/").split(".").join("="),"undefined"!==typeof e?Uint8Array.from(e.from(t,"base64")):Uint8Array.from(atob(t),(function(e){return e.charCodeAt(0)}))}},{key:"decodeTokens",value:function(e){var t=this;this.debug&&(console.log("decodeTokens fired"),console.log(e));var n=[];return e.length&&e.forEach((function(e){if(e.token){var a=new t.tokenParser(t.base64ToUint8array(e.token).buffer);a&&a[t.unsignedTokenDataName]&&n.push(a[t.unsignedTokenDataName])}else console.log("empty token data received")})),n}},{key:"attachPostMessageListener",value:function(e){window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)}},{key:"detachPostMessageListener",value:function(e){window.addEventListener?window.removeEventListener("message",e,!1):window.detachEvent("onmessage",e)}}]),t}()}).call(this,n(90).Buffer)},97:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var a=n(5),r=n(6),i=n(17),o=n(19),s=(n(74),n(76)),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(a.a)(this,e),"string"==typeof t)throw new TypeError("Unimplemented: Not accepting string yet.");if(t instanceof ArrayBuffer){var n=Object(i.fromBER)(t);this.fromSchema(n.result)}else this.devconId=Object(o.getParametersValue)(t,"devconId"),this.ticketId=Object(o.getParametersValue)(t,"ticketId"),this.ticketClass=Object(o.getParametersValue)(t,"ticketClass")}return Object(r.a)(e,[{key:"fromSchema",value:function(t){Object(o.clearProps)(t,["devconId","ticketId","ticketClass"]);var n=Object(i.compareSchema)(t,t,e.schema());if(!1===n.verified)throw new Error("Object's schema was not verified against input data for DevconTicket");if("devconId"in n.result&&(this.devconId=n.result.devconId.valueBlock.value),"ticketId"in n.result){var a=n.result.ticketId.valueBlock._valueHex;this.ticketId=BigInt("0x"+Object(o.bufferToHexCodes)(a))}if("ticketClass"in n.result){var r=n.result.ticketClass.valueBlock._valueHex;this.ticketClass=BigInt("0x"+Object(o.bufferToHexCodes)(r))}}}],[{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(o.getParametersValue)(e,"names",{});return new i.Sequence({name:t.blockName||"ticket",value:[new i.Utf8String({name:t.devconId||"devconId"}),new i.Integer({name:t.ticketId||"ticketId"}),new i.Integer({name:t.ticketClass||"ticketClass"})]})}}]),e}(),l=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(a.a)(this,t),"string"==typeof n){var r=n.startsWith("https://")?new URL(n).searchParams.get("ticket"):n,l=r.split("_").join("/").split("-").join("+").split(".").join("=");n="undefined"!==typeof e?Uint8Array.from(e.from(l,"base64")).buffer:Uint8Array.from(atob(l),(function(e){return e.charCodeAt(0)})).buffer}if(n instanceof ArrayBuffer){var u=Object(i.fromBER)(n);this.fromSchema(u.result)}else this.ticket=new c(n.ticket),this.commitment=Object(o.getParametersValue)(n,"commitment"),this.publicKeyInfo=new s.a(n.publicKeyInfo),this.signatureValue=Object(o.getParametersValue)(n,"signatureValue")}return Object(r.a)(t,[{key:"fromSchema",value:function(e){Object(o.clearProps)(e,["ticket","commitment","publicKeyInfo","signatureValue"]);var n=Object(i.compareSchema)(e,e,t.schema());if(!1===n.verified)throw new Error("Object's schema was not verified against input data for SignedDevconTicket");this.ticket=new c(n.result.ticket.valueBeforeDecode),"commitment"in n.result&&(this.commitment=n.result.commitment.valueBlock.valueHex),this.publicKeyInfo=new s.a({schema:n.result.publicKeyInfo});var a=n.result.signatureValue;this.signatureValue=a.valueBlock.valueHex}}],[{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(o.getParametersValue)(e,"names",{});return new i.Sequence({name:t.blockName||"SignedDevconTicket",value:[c.schema(e),new i.OctetString({name:"commitment"}),new i.BitString({name:"signatureValue"})]})}}]),t}()}).call(this,n(90).Buffer)}},[[155,1,2]]]);
//# sourceMappingURL=main.199a3f75.chunk.js.map