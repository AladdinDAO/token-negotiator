<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devon Token Outlet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@200;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/outlet.css">
  <script src="https://devcontickets.herokuapp.com/outlet/bigInteger.min.js"></script>
  <script src="https://devcontickets.herokuapp.com/outlet/negotiator.js"></script>
  <script src="https://devcontickets.herokuapp.com/outlet/authenticator.js"></script>
</head>
<body>
  <div class="dvn-tk-outlt">
    <div class="modal">
      <div class="brand"></div>
      <p class="headline">Available Tokens</p>
      <div class="token-container"></div>
    </div>
  </div>
  <script>

    // Origin Config
    const originData = {
      hostComponents: {
        button: '<button onclick="negotiator.toggleTokenHandler()" style="height:80px; width:80px; border: 0; background-image: url(http://127.0.0.1:8080/img/button.svg); box-shadow: 0 2px 5px 0 #676767; border-radius: 64px; cursor: pointer; z-index: 999; position: relative;"></button>'
      },
      data: {
        selectedTokens: [],
        whiteList: [
          'http://localhost:3000/'
        ],
      }
    }

    // Handle Incoming Event Requests From Parent Window.
    window.addEventListener('message', function(event) {
      // if(event.origin !== '*') return; // review if we should whitelist access some events.
      eventController(event.data);
    },false);

    // Handle Event Business Logic
    function eventController(data) {
      switch(data.evt) {
        case 'getTokenButtonHTML':
          window.top.postMessage({ evt: 'setTokenButtonHTML', button: originData.hostComponents.button }, "*");
          break;
        case 'setSelectedTokens':
          // defines the tokens that are available to the website
          window.top.postMessage({ evt: 'setSelectedTokens', selectedTokens: originData.selectedTokens }, "*");
          break;
        case 'setToggleModalHandler':
          // defines the tokens that are available to the website
          toggleTokenButtonHandler();
          break;
      }
    }

    function tokenToggleHandler() {

    }

    // Handle Event To Hide / Show The Token Selection Modal.
    function toggleTokenButtonHandler() {
      var element = document.querySelector(".dvn-tk-outlt .modal")
      element.classList.toggle("open");
      if(element.classList.contains("open")) {
        element.classList.add("open");
      } else {
        element.classList.add("open");
      }
    }

  </script>
	<!-- <script src='bundle.js'></script> -->
	<script>
    let negotiator = new Negotiator();
  </script>
</body>
</html>